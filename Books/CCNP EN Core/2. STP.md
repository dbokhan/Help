# STP
## Root Bridge Election
The first step with STP is to identify the root bridge. As a switch initializes, it assumes that it is the root bridge and uses the local bridge identifier as the root bridge identifier. It then listens to its neighbor’s configuration BPDU and does the following:
- If the neighbor’s configuration BPDU is inferior to its own BPDU, the switch ignores that BPDU.
- If the neighbor’s configuration BPDU is preferred to its own BPDU, the switch updates its BPDUs to include the new root bridge identifier along with a new root path cost that correlates to the total path cost to reach the new root bridge.

STP deems a switch more preferable if the priority in the bridge identifier is lower than the priority of the other switch’s configuration BPDUs. If the priority is the same, then the switch prefers the BPDU with the lower system MAC.

The priority in the configuration BPDU packets is actually the priority plus the value of the sys-id-ext (which is the VLAN number).

As the BPDU is received, the local root path cost is the advertised root path cost plus the local interface port cost. The root path cost is always zero on the root bridge.

## Locating Root Ports
After the switches have identified the root bridge, they must determine their root port (RP).
The switch compares the BPDU information to identify the RP. The RP is selected using the following logic:
1. The interface associated to lowest path cost is more preferred.
2. The interface associated to the lowest system priority of the advertising switch is
preferred next.
3. The interface associated to the lowest system MAC address of the advertising switch is preferred next.
4. When multiple links are associated to the same switch, the lowest port priority from the advertising switch is preferred.
5. When multiple links are associated to the same switch, the lower port number from the advertising switch is preferred.

>#show spanning-tree root
>
>The root bridge can be identified for a specific VLAN through the use of the command show spanning-tree root and examination of the CDP or LLDP neighbor information to identify the host name of the RP switch. The process can be repeated until the root bridge is located.

## Locating Blocked Designated Switch Ports
The logic to calculate which ports should be blocked between two non-root switches is as follows:
1. The interface is a designated port and must not be considered an RP.
2. The switch with the lower path cost to the root bridge forwards packets, and the one
with the higher path cost blocks.
3. The system priority of the local switch is compared to the system priority of the remote switch. The local port is moved to a blocking state if the remote system priority is lower than that of the local switch.
4. The system MAC address of the local switch is compared to the system priority of the remote switch. The local designated port is moved to a blocking state if the remote system MAC address is lower than that of the local switch.

>#show spanning-tree [vlan vlan-id] ! provides useful information for locating a port’s STP state.

These port types are expected on Catalyst switches:
- **Point-to-point (P2P):** This port type connects with another network device (PC or RSTP switch).
- **P2P edge:** This port type specifies that portfast is enabled on this port.
- ***TYPE_Inc:** This indicates a port configuration mismatch between this Catalyst switch and the switch it is connected to. (For exmample: the port mode access versus trunk being misconfigured)
