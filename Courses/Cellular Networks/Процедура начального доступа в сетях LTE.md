# Процедура начального доступа в сетях WCDMA (3G)

## Когда происходит процедура случайного доступа в WCDMA? (3 базовых сценария)

1) **Начальное установление RRC Connection**
Всякий раз когда абоненское устройство находится в состоянии IDLE (в режиме ожидания соединения), ему необходимо установить сигнальное соединение (RRC Connection) и для этого посылается сообщение RRC Connection Request через процедуру случайного доступа.

2) **Необходимо выполнить процедуру Cell_Upadate в режиме Cell_FACH или Cell_PCH**

3) **Необходимо передать данные UpLink в режиме Cell_FACH**

Сценарий 1 будет подробно рассмотрен ниже.

Сценарий 2 проходит по упрощенной схеме и отличается названиями сообщений.

Сценарий 3 - в качестве Message передаются сразу данные CCCH+DTCH с использованием для адресации RNTI (Random Network Temporary ID) абонента (DCCH+DTCH/RACH/PRACH).

## Процедура случайного доступа и установление сигнального соединения (RRC Connection)

1) Абонент выбирает **подходящий момент**, посылает преамбулу (Preamble1) и ожидает ответ в течении некоторого времени, который должен прийти по каналу AICH. Если ответ не приходит, то посылка преамбулы повторяется (каждый повтор преамбулы может быть немного изменен).

2) Когда по каналу AICH приходит ответ от базовой станции, абонент отсылает последовательность PRACH

AICH - Acquisition Indication Channel

PRACH - Physical Random Access Channel 

SFN - Serial Frame Number

15 тайм-слотов AICH или PRACH = 2 SFN = 20 ms

## Что за последовательность посылает абонент (UE) в качестве преамбулы?

ASC - Access Service Class. (Конфигурируется на устройстве RNC - Radio Network Controller)

В соответствии с разрешением ASC абонентское устройство выбирает случайных образом Signature. Это последовательность из 16 симовлов. Преамбула - это 256-ти кратное повторение преедачи Signature. Стандарты WCDMA определяют всего 16 различных последовательсноей Signature.

На каждую Signature у базовой станции есть 2 варианта ответа (положительный и отрицитальный), который посылается по каналу AICH.

## Начальная мощность передачи первой преамбулы

Начальная мощность передачи первой преамбулы определяется формулой:

	Preamble_Initial_Power = ConstantValue + UL interference + PCPICHPower - CPICH_RSCP

	ConstantValue - по сути - уровень SINR (сигнал/шум) необходимый для нормальной демодуляции преамбулы канала PRACH - рекомендуемое значение на нормальных сотах = -20dB

	ConstantValue + UL interference - желательный уровень приема сигнала преамбулы канала PRACH на стороне NodeB

	UL interference - уровень интерференции на стороне NodeB = RTWP (Receive Total Wide Band Power) измеряется NpdeB и передается в системной информации (SIB7), типичные значения на нормальных сотах порядка -100 dBm

	PCPICHPower - CPICH_RSCP - уровень потерь в тракте от передатчика NodeB до приемника UE (считается, что потери UP и DL примерно одинаковы и, соответственно, потери в тракте от передатчика UE до приемника NodeB - примерно такие же)

	PCPICHPower - уровень мощности передачи канала P-CPICH, (пилотный канал) задается на RNC, значение передается в системной информации SIB5. На макросотах рекомендуется устанавливать на уровне 10% от номинальной мощности соты, в частности, при мощности соты = 20 Вт (+43 dBm)
	рекомендуемая мощность P-CPICH = 2Вт (+33 dBm)

	CPICH_RSCP - уровень приема канала P-CPICH на стороне UE. При оптимизации покрытия сети считаются нормальными уровни выше -95 dBm, хотя голосовая связь может осуществляться в сельской местности - вплоть до уровней -126 dBm, а до уровней -105 dBm еще могут работать технологии HSPA.

	PS. Все значения в формуле в размерности dB, а результат лучше переводить в mW.

Отслеживание успешных и неуспешных сообщений RRC connection позволяет определять KPI.

RRC connection setup success rate - отношение успешных и неуспешных RRC Connection должен быть >= 98%

[Ссылка на вебинар](https://www.youtube.com/watch?v=0f-LeBCBRyY)


# Процедура начального доступа в сетях LTE

## Цель процедуры Random Access LTE
Цель - обеспечить синхронизацию в направлении UpLink.
Т.е. обеспечить попадение излучения абонентского устройства в заданные врмененные интервалы (тайм - слоты).

При перемещении абонента на расстояния в несколько километров от соты, задержки связанные с распространением сигнала становятся существенными и требуют юстировки времени TA.

TA в GSM - это Timing Advanced

TA в LTE - это Time Alignment

По смыслу это одно и тоже, на какое время опережения абонент должен раньше начать передачу, что бы попасть в свои временные интервалы.

В зависимости от планируемого радиуса сот необходимо планировать различные Guard Time (GT) в соответствии с вариантами, заложенными в стандарте.

## Когда происходит процедура случайного доступа? (3 базовых сценария)

1. Необходимо установить RRC Connection для передачи сигнализации и затем, возможно, данных - передается сообщение RRC Connection Request

2. Необходимо выполнить процедуру восстановления соединения RRC Connection Reestablishment при кратковременном обрыве, напрмер, при неудачном хэндовере

3. Необходимо выполнить хэндовер на новую соту

## Два типа процедур Random Access в LTE

1. **Contention based (на основе конфликта)** - UE случайным образом выбирает преамбулу (из разрешенных) и посылает ее на eNodeB. (см. картинку) 

Этот тип процедуры Random Access возможно использовать для всех сценариев, всегда используется при начальном установлении RRC Connection. При хэндовере, как правило, не используется.

2. **Non-contention based (без конфликта)** - до начала процесса доступа eNodeB назначает выделенную (dedicated) преамбулу для UE - никаких конфликтов. 

Возможно только для сценариев хэндовера и переустановления соединения по "инициативе" eNodeB.

![](https://image.slidesharecdn.com/schedulingrequestatrandomaccess-130717213250-phpapp01/95/scheduling-request-at-random-access-3-638.jpg?cb=1374096819)

## Как формируются и передаются последовательности PRACH (LTE)?

Различные преамбулы на соте генерируются с использованием циклического сдвига корневых последовательностей Жадова-Чу (cyclic shifts of Zadoff-Chu (ZC) Root Sequences) длиной 839 символов (для Preamble Format 0~3). Всего такиз корневых последовательностей 838.

**Root Sequence Index (RSI)** значения 0~837

Стандарт LTE определяет, что для каждой соты должно быть сгенерировано 64 различных преамбулы. Актуальной **циклический сдвиг Ncs** определяется требованиями к соте, в частности, **максимальным радиусов доступа соты**. Если с учетом этих требований из одной Root Sequencee получается меньше 64 последовательностей, то на соте используется следующая по номеру.

## Формат преамбулы

Чаще всего используется преамбула Format 0. При использовании TDD используется преамбула Format 4. Format 3 используется для больших сот до 100 км радиуса.

## Параметры PRACH

**Root Sequence Index (RSI)** - номер начальной корнейвой последовательности root Zadoff-Chu sequence

**Zero Correlation Zone Configuration (NCS)** - определяет, сколько корневых последовательностей ZC будет использовано на соте, зависит от радиуса соты и флага высоких скоростей движения

**High Speed Flag** - флаг высоких скоростей движения (свыше 150 км/ч)

**PRACH Configuration Index** - определяет, какие ресурсы занимает PRACH во временном домене (кадры и субкадры)

**PRACH Frequenct offset** - показывает положение канала PRACH в частотном домене, (отступ от нижней границы полосы, задается в PRB)