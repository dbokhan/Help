# Cisco IOS XR

**Модульная ОС**

- Основные модули обеспечивают базовую функциональность

- Опциональные модули могут быть установлены по требованию

**Изоляция процессов**

- Виртуальное пространство памяти, межпроцессное API

- Динамически подгружаемые библиотеки

**SDR (Secure Domain Router)** - изоляция экземпляров IOS XR

## Защита процессов

**Для активного процесса на RP запускается standby-близнец**

**Процессы хранят свое состояние в Crimson DB**

- При переключении на standby-процесс считывается чекпойнт состояния

- QNet Symlink Manager и Event Connection Manager осуществляют переключение при сбое активного процесса

## Нумерация версий Cisco ISO XR

**Номер версии состоит из трех частей (A.F.M):**

- A - Major release (глобальные изменения, требует рестарт)

- F - Minor release (минорные изменения, обычно не требует рестарта)

- M - Maintencance release (исправление ошибок, не требует рестарта)

**A/F-релизы выходят каждые 8 месяцев, M-релизы - раз в 4 месяца**

**Жизненный цикл A/F-релиза: 6.5 лет**

**Жизненый цикл релиза**:

CCO - момент выхода нового релиза (загрузка на сайт Cisco) (FCS)

Announce EoS - (через 6 месяцев) момент объявления, когда этот релиз перестанут продавать (FCS+6)

EoS - перестали продавать IOS (не выкладывается на портал cisco) (FCS+18)

EoM - возможна рассширенная поддержка за деньги (FCS+24)

EoM PSIRT - (FCS+48)

EOL - выход из жизни релиза IOSа (FCS+78), циска не помогает

## Управление устройством IOS XR

**CLI**

- RS232 консоль/AUX к активному RP

- IP VTY к активному RP на MGMT-интерфейс

- IP VTY к активному RP через virtual address

**Приглашение ко вводу:**

- RP: route processor

- 0: номер шасси

- RSP0: либо RSP0, либо RSP1

- CPU0: номер CPU на RP

- router: hostname

> RP/0/RP0/CPU0:router# show version
>  Mon May 31 02:14:12.722 DST
>  Cisco IOS XR Software, Version 4.1.0[Default]
>  Copyright (c) 2010 by Cisco Systems, Inc.

## Режимы CLI

В IOS XR нет режима enable. Вместо команды configure terminal используется команда configure. Существует режим admin exec и config-admin, который НЕ является подрежимом обычного config и создан для настройки контекстов.

## Активная и кандидатская конфигурация

**Измнения в конфигурацию не вступают в силу немедленно**

**Активная конфигурация работает в данный моммент и будет работать после перезагрузки системы**

**Кандидатская конфигурация** - редактируемая временная конфигурация, которая может впоследствии стать активной

- Создается при взоде в конфигурационный режим

- Первоначально заполняется содержимым активной конфигурации

**После редактирования кандидатской конфигарции требуется подтвердить изменения командой commit**

- IOS XR проверяет кандидатскую конфигурацию на синтаксические ошибки и инстуллирует ее как активную конфигурацию

## Управление конфигурацией

**Двухэтапная конфигурация**

- Первый этап: изменения кандидатской конфигурации, проверка синтаксиса

- Второй этап: применение изменений в активную конфигурацию (commit)

**Изменения сразу сохраняются в энергонезависимую память**

- **Save** - сохранить конфигурацию в заданный файл

- **Load** - загрузить конфигурацию из файла

- **Commit replace** - очистать конфигурацию (опасно!)

> **commit confirmed** помогает откатить примененную кандидатскую конфигурацию через некоторое время

> **commit best-effort** применить в конфигурацию все верно веденные команды которые только возможно

## Применение конфигурации

**Просмотр конфигурации**

- **show config**: отобразить ожидающие изменения

- **show config merge**: отобразить результирующую конфигурацию

- **show config changes**: отобразить изменения после commit replace

**Применение конфигурации**:

- **commit**: применить изменения атомарно (все или ничего)

- **commit best-effort**: применять изменения по отдельности

- **comit confirmed <timer>**: применить изменения временно

- **commit replace**: заменяет текущую конфигурацию содержимым буфера

- **commit label**: применять изменения и добавить описане для истории

- **commit comment**: добавить комментарий к исторической записи

## Жизнь файла конфигурации

**IOS XR сохраняет предыдущие активные конфигурации**

**Можно восстановить предыдущую конфигурацию командой rollback**

## История изменений

**Отобразить историю изменений**:

> show configuration history

**Откатиться на N элементов назад**:

> rollback configuration last 2

**Откатиться на элемент N**:

> rollback configuration to 4

## Эксклюзивная конфигурация

**По умолчанию одновременно несколько пользователей могут находится в режиме редактирования конфигурации**

**Использование команды configure exclusive позволяет только одному пользователю редактировать конфигурацию**

Посмотреть кто захватил редактирование:

> show configuration lock
> show configuration sessions

## Обновление системы или пакета

**Обновление выполняется с помощью PIE-файлов**:

> (admin)# copy tftp://10.10.10.100/asr9k0mgbl-p.pie-4.1.0 disk1:
> (admin)# install add disk1:asr9k0mgbl-p.pie-4.1.0
> (admin)# install activate disk1:asr9k0mgbl-p.pie-4.1.0
> (admin)# install commit

**Откатывать обновления**:

> (admin)# show install rollback 2

> (admin)# install rollback to 2

**Просмотр установленных пакетов:**

> # show install active

**Деактивация и удаление пакетов**:

> (admin)# install deactivate nsc6k-sysadmin-5.0.0..4oI.CSCiu84128-0.0.9.i

> (admin)# install commit

> (admin)# install remove nsc6k-sysadmin-5.0.0..4oI.CSCiu84128-0.0.9.i

**Деактивация и удаление пакетов**:

>(admin)# install remove inactive

## TURBOBOOT (аналог ROMMON)

**Механизм аварийного восстановления IOS XR**:

- На живом RP:

> cfs check -проверка файловой системы на ошибки и исправления
>
> admin
>
> (admin)# config-register 0x0 location all
>
> (admin)# reload location all

> rommon> unset BOOT
>
> rommon> unset TFTP FILE
>
> rommon> sync -реплицирует состояние на второй RP
>
> rommon> IP ADDRESS=192.168.1.11
>
> rommon> IP SUBNET MASK=255.255.255.0
>
> rommon> DEFAULT GATEWAY=192.168.1.1
>
> rommon> TURBOBOOT=on, disk0, clear ! format, если не требуется сохранение конфигурации
>
> sync
>
> boot tftp://192.168.1.10/softdir/comp-asr9k-mini.vm-3.9.0

- На резервном RP

> rommon> confreg 0x102
>
> rommon> reset