# Создание сертификата Root CA с помощью openssl

## 1. Генерация приватного ключа
```
openssl genrsa -aes256 -out ca.key 4096
```
Приватный ключ используется, когда CA подписывает другие сертификаты.

[Команда genrsa](https://www.openssl.org/docs/manmaster/man1/genrsa.html) - генерирует приватный RSA ключ.

- *Опция -aes256* - шифрует ключ перед выводов в файл.

- *Опция -out* - выводит ключ в указанный файл.

- *Опция 4096* - указывает размер ключа в битах. Должна указываться в конце команды, по-умолчанию равно 2048.

## 2. Создание самоподписанного сертификата CA
```
openssl req -new -x509 -days 3650 -key ca.key -out ca.crt
```

[Команда req](https://www.openssl.org/docs/manmaster/man1/req.html) - создает и обрабатывает запросы сертификатов в формате PKCS#10. Также, может создавать самоподписанные сертификаты для использования в качестве корневого CA.

- Опция -new генерирует запрос на сертификат. Если эта опция не указана, то будет сгенерирован новый приватный RSA ключ.

- Опция -x509 - команда для выпуска самоподписанного сертификата, вместо создания запроса (request). 

- Опция -days - указывает срок валидности сертификата, если присутствует опция -x509. По-умолчанию 30 дней.

- Опция -key - указывает какой приватный ключ будет использоваться.

- Опция -out - выводит сертификат в указанный файл

# Создание SAN сертификата с помощью openssl

SAN сертификат - это сертификат содержащий поле Subject Alternative Names, т.е. один сертификат может иметь несколько Common Name (CN).

Для веб-сайтов лучше создавать SAN сертификаты, т.к. Chrome читает без ошибок только их.

## 1. Генерация приватного ключа сайта
```
openssl genrsa -des3 -out site.key 2048
```

## 2. Создание файла с дополнительными параметрами (с доп. именами)

Пример файла san.cnf
```
[ req ]
default_bits       = 2048
distinguished_name = req_distinguished_name
req_extensions     = req_ext
[ req_distinguished_name ]
countryName                 = Country Name (2 letter code)
stateOrProvinceName         = State or Province Name (full name)
localityName               = Locality Name (eg, city)
organizationName           = Organization Name (eg, company)
commonName                 = Common Name (e.g. server FQDN or YOUR name)
[ req_ext ]
subjectAltName = @alt_names
[alt_names]
DNS.1   = home.local
DNS.2   = www.home.local
```
## 3. Создание запроса на подпись сертификата
```
openssl req -new -days 365 -key site.key -out site.csr -config san.cnf
```

- Опция -config - позволяет указать файл с расширенными настройками

## 4. Подпись сертификата сайта сертификатом CA
```
openssl x509 -req -days 365 -in site.csr -CA ca.crt -CAkey ca.key -set_serial 01 -extfile san.cnf -extensions req_ext -out site.crt
```

[Команда x509](https://www.openssl.org/docs/manmaster/man1/x509.html) - может использоваться для просмотра сертификатов, конвертации их в различные формы, подписи запросов и редактирования доверия сертификатам.

- Опция -req - по-умолчанию команда x509 ждет на вход сертификат, эта команда позволяет подать на вход запрос (request)

- Опция -days - указывает сколько дней сертификат будет валидным. По-умолчанию 30 дней.

- Опция -in - указывает на входной сертификат или запрос

- Опция -CA - указывает на сертификат CA, который будет подписывать запрос на входе. Эта опция обычно идет в паре с опцией -req, без нее входящий сертификат должет быть самоподписанным.

- Опция -CAkey - указывает на приватный ключ CA, которым будет подписан запрос на входе.

- Опция -set_serial - указывает на серийный номер подписываемого сертификата. Может быть десятичным или шестнадцатеричным числом.

- Опция -extfile - указывает на файл с расширенными настройками. Если опция не указана, то расширения добавлены не будут.

- Опция -extension - указывает раздел в файла с расширенными настройками, которые будут добавлены в сертификат на выходе. Если не указывать эту опцию, то по умолчанию берется раздел Default.

- Опция -out - выводит сертификат в указанный файл